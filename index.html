<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Premium Birthday Card Maker | SkillSphere</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&family=Dancing+Script:wght@700&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    :root {
      --primary: #FF6B6B;
      --secondary: #4ECDC4;
      --accent: #FFE66D;
      --gold: #D4AF37;
      --light: #F7FFF7;
      --dark: #292F36;
      --text: #4A4A4A;
      --shadow: 0 10px 30px rgba(0,0,0,0.1);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      --header-height: 80px;
      --footer-height: 60px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
      min-height: 100vh;
      padding-top: var(--header-height);
      padding-bottom: var(--footer-height);
      position: relative;
    }
    
    /* Header Styles */
    .main-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: var(--header-height);
      background: rgba(255,255,255,0.95);
      box-shadow: 0 2px 20px rgba(0,0,0,0.08);
      z-index: 1000;
      display: flex;
      align-items: center;
      padding: 0 2rem;
      backdrop-filter: blur(10px);
    }
    
    .logo {
      display: flex;
      align-items: center;
      text-decoration: none;
    }
    
    .logo-icon {
      font-size: 2rem;
      color: var(--primary);
      margin-right: 0.75rem;
    }
    
    .logo-text {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 1.5rem;
      color: var(--dark);
      background: linear-gradient(135deg, var(--primary), var(--gold));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .powered-by {
      margin-left: auto;
      font-size: 0.85rem;
      color: var(--text);
      opacity: 0.8;
      font-weight: 500;
    }
    
    .powered-by span {
      color: var(--primary);
      font-weight: 700;
    }
    
    /* Main Content */
    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      position: relative;
    }
    
    .app-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .app-title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(2.5rem, 5vw, 3.5rem);
      color: var(--dark);
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--primary), var(--gold));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      position: relative;
      display: inline-block;
    }
    
    .app-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--gold));
      border-radius: 4px;
    }
    
    .app-subtitle {
      font-size: 1.1rem;
      color: var(--text);
      opacity: 0.8;
      max-width: 700px;
      margin: 0 auto;
    }
    
    /* Compact Form Styling */
    .form-container {
      background: white;
      border-radius: 20px;
      padding: 2.5rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.3);
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,0.95);
    }
    
    .form-section {
      margin-bottom: 2rem;
    }
    
    .section-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem;
      color: var(--dark);
      margin-bottom: 1.2rem;
      position: relative;
      display: inline-block;
    }
    
    .section-title::after {
      content: '';
      position: absolute;
      bottom: -6px;
      left: 0;
      width: 40px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--gold));
      border-radius: 3px;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    label {
      display: block;
      margin-bottom: 0.6rem;
      font-weight: 600;
      color: var(--dark);
      font-size: 0.9rem;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      font-family: inherit;
      font-size: 0.95rem;
      transition: var(--transition);
      background: rgba(255,255,255,0.8);
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    /* Compact Image Upload */
    .upload-area {
      border: 2px dashed #e0e0e0;
      border-radius: 14px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      margin-bottom: 1.2rem;
      background: rgba(255,255,255,0.5);
    }
    
    .upload-area:hover {
      border-color: var(--primary);
      background: rgba(255, 107, 107, 0.05);
    }
    
    .upload-icon {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    
    .upload-text {
      color: var(--text);
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }
    
    .upload-subtext {
      font-size: 0.8rem;
      color: #999;
    }
    
    .image-preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .preview-item {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      aspect-ratio: 1/1;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      transition: var(--transition);
    }
    
    .preview-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.12);
    }
    
    .preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .remove-btn {
      position: absolute;
      top: 6px;
      right: 6px;
      background: var(--primary);
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      opacity: 0.9;
      font-size: 0.8rem;
    }
    
    .remove-btn:hover {
      opacity: 1;
      transform: scale(1.1);
    }
    
    /* Compact Buttons */
    .btn {
      background: linear-gradient(135deg, var(--primary), var(--gold));
      color: white;
      border: none;
      padding: 0.9rem 2rem;
      font-size: 1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--gold), var(--primary));
      opacity: 0;
      transition: var(--transition);
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
    }
    
    .btn:hover::after {
      opacity: 1;
    }
    
    .btn span {
      position: relative;
      z-index: 2;
    }
    
    .btn i {
      margin-right: 0.5rem;
      font-size: 0.9rem;
    }
    
    .btn-secondary {
      background: white;
      color: var(--primary);
      border: 1px solid var(--primary);
      box-shadow: none;
      margin-left: 1rem;
    }
    
    .btn-secondary:hover {
      background: var(--light);
      box-shadow: none;
    }
    
    .btn-container {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }
    
    /* Enhanced Card Preview */
    .card-preview-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: var(--transition);
      padding: 1rem;
      backdrop-filter: blur(8px);
    }
    
    .card-preview-container.show {
      opacity: 1;
      pointer-events: all;
    }
    
    .card-preview {
      background: white;
      border-radius: 24px;
      width: 100%;
      max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 30px 60px rgba(0,0,0,0.4);
      position: relative;
      transform: scale(0.95);
      transition: var(--transition);
    }
    
    .card-preview-container.show .card-preview {
      transform: scale(1);
    }
    
    .close-preview {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--primary);
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      transition: var(--transition);
      font-size: 1.2rem;
    }
    
    .close-preview:hover {
      transform: rotate(90deg);
      background: var(--gold);
    }
    
    .preview-content {
      padding: 3rem;
      position: relative;
    }
    
    .preview-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      opacity: 0.5;
    }
    
    /* Theme-specific backgrounds */
    .theme-elegant .preview-bg {
      background: linear-gradient(135deg, rgba(255,235,215,0.2) 0%, rgba(252,182,159,0.2) 100%);
    }
    
    .theme-modern .preview-bg {
      background: linear-gradient(135deg, rgba(215,236,255,0.2) 0%, rgba(159,202,252,0.2) 100%);
    }
    
    .theme-fun .preview-bg {
      background: linear-gradient(135deg, rgba(255,215,215,0.2) 0%, rgba(252,159,159,0.2) 100%);
    }
    
    .theme-romantic .preview-bg {
      background: linear-gradient(135deg, rgba(255,215,255,0.2) 0%, rgba(252,159,239,0.2) 100%);
    }
    
    .preview-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
      z-index: 1;
    }
    
    .preview-title {
      font-family: 'Dancing Script', cursive;
      font-size: clamp(2.5rem, 6vw, 4rem);
      color: var(--dark);
      margin-bottom: 0.5rem;
      line-height: 1.2;
    }
    
    .preview-name {
      background: linear-gradient(135deg, var(--primary), var(--gold));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: inline;
    }
    
    .preview-subtitle {
      font-size: 1.2rem;
      color: var(--text);
      opacity: 0.8;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    .preview-card {
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0,0,0,0.12);
      aspect-ratio: 1/1;
      transition: var(--transition);
    }
    
    .preview-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
    }
    
    .preview-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }
    
    .preview-card:hover img {
      transform: scale(1.05);
    }
    
    .preview-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
      color: white;
      padding: 1rem;
      font-size: 0.9rem;
      text-align: center;
      opacity: 0;
      transition: var(--transition);
    }
    
    .preview-card:hover .preview-caption {
      opacity: 1;
    }
    
    .preview-message {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      margin: 2rem 0;
      position: relative;
      z-index: 1;
      box-shadow: 0 5px 20px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .preview-message::before {
      content: '';
      position: absolute;
      top: -1px;
      left: -1px;
      right: -1px;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--gold));
      border-radius: 16px 16px 0 0;
    }
    
    .preview-message-text {
      font-size: 1.1rem;
      line-height: 1.8;
      position: relative;
    }
    
    .preview-footer {
      text-align: center;
      font-style: italic;
      color: var(--text);
      opacity: 0.8;
      margin-top: 1.5rem;
      position: relative;
      z-index: 1;
    }
    
    .preview-signature {
      font-family: 'Dancing Script', cursive;
      font-size: 1.8rem;
      color: var(--primary);
      margin-top: 0.5rem;
      display: inline-block;
    }
    
    /* Floating Elements */
    .floating-elements {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    
    .floating-element {
      position: absolute;
      opacity: 0.7;
      animation: float-up 15s infinite linear;
    }
    
    @keyframes float-up {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        transform: translateY(-100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Footer */
    .main-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: var(--footer-height);
      background: rgba(255,255,255,0.95);
      box-shadow: 0 -2px 20px rgba(0,0,0,0.05);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
    }
    
    .footer-content {
      font-size: 0.9rem;
      color: var(--text);
      text-align: center;
    }
    
    .footer-content a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }
    
    .footer-content a:hover {
      text-decoration: underline;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .form-container {
        padding: 2rem 1.5rem;
      }
      
      .preview-content {
        padding: 2rem 1.5rem;
      }
      
      .btn-container {
        flex-direction: column;
      }
      
      .btn-secondary {
        margin-left: 0;
        margin-top: 1rem;
      }
      
      .image-preview {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .main-header {
        padding: 0 1.5rem;
      }
      
      .logo-icon {
        font-size: 1.8rem;
      }
      
      .logo-text {
        font-size: 1.3rem;
      }
      
      .powered-by {
        font-size: 0.8rem;
      }
    }
    
    @media (max-width: 480px) {
      .app-container {
        padding: 1.5rem;
      }
      
      .image-preview {
        grid-template-columns: 1fr;
      }
      
      .app-title {
        font-size: 2rem;
      }
      
      .app-subtitle {
        font-size: 1rem;
      }
      
      .form-container {
        padding: 1.5rem 1rem;
      }
      
      .main-header {
        padding: 0 1rem;
      }
      
      .logo-icon {
        font-size: 1.5rem;
        margin-right: 0.5rem;
      }
      
      .logo-text {
        font-size: 1.1rem;
      }
      
      .powered-by {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Fixed Header -->
  <header class="main-header">
    <a href="#" class="logo">
      <i class="fas fa-birthday-cake logo-icon"></i>
      <span class="logo-text">Birthday Card Maker</span>
    </a>
    <div class="powered-by">Powered by <span>SkillSphere</span></div>
  </header>
  
  <!-- Main Content -->
  <div class="app-container">
    <header class="app-header">
      <h1 class="app-title">Premium Birthday Card Maker</h1>
      <p class="app-subtitle">Create stunning, personalized birthday cards with your photos and messages. Perfect for making someone's special day unforgettable.</p>
    </header>
    
    <div class="form-container">
      <div class="form-section">
        <h2 class="section-title">Celebrant Details</h2>
        <div class="form-group">
          <label for="celebrantName">Birthday Person's Name</label>
          <input type="text" id="celebrantName" placeholder="e.g., Samuel">
        </div>
        <div class="form-group">
          <label for="birthdayTheme">Card Theme</label>
          <select id="birthdayTheme">
            <option value="elegant">Elegant Gold</option>
            <option value="modern">Modern Minimal</option>
            <option value="fun">Fun Celebration</option>
            <option value="romantic">Romantic Touch</option>
          </select>
        </div>
      </div>
      
      <div class="form-section">
        <h2 class="section-title">Your Message</h2>
        <div class="form-group">
          <label for="birthdayMessage">Personalized Birthday Message</label>
          <textarea id="birthdayMessage" placeholder="Write your heartfelt message here..."></textarea>
        </div>
        <div class="form-group">
          <label for="signature">Your Name/Signature</label>
          <input type="text" id="signature" placeholder="Who's this card from?">
        </div>
      </div>
      
      <div class="form-section">
        <h2 class="section-title">Photos & Captions</h2>
        <div class="upload-area" id="uploadArea">
          <div class="upload-icon"><i class="fas fa-images"></i></div>
          <p class="upload-text">Click to upload photos</p>
          <p class="upload-subtext">(Up to 4 high-quality images)</p>
          <input type="file" id="photoUpload" accept="image/*" multiple style="display: none;">
        </div>
        <div class="image-preview" id="imagePreview"></div>
        <div class="form-group">
          <label for="photoCaptions">Photo Captions (comma separated)</label>
          <input type="text" id="photoCaptions" placeholder="e.g., Smart, Funny, Kind, Amazing">
        </div>
      </div>
      
      <div class="form-section">
        <h2 class="section-title">Extras</h2>
        <div class="form-group">
          <label for="musicFile">Background Music (optional)</label>
          <div class="upload-area" id="musicUploadArea" style="padding: 1rem;">
            <div class="upload-icon"><i class="fas fa-music"></i></div>
            <p class="upload-text">Add a birthday song</p>
            <input type="file" id="musicFile" accept="audio/*" style="display: none;">
          </div>
          <audio id="audioPlayer" controls style="width: 100%; margin-top: 1rem; display: none;"></audio>
        </div>
      </div>
      
      <div class="btn-container">
        <button class="btn" id="generateBtn"><i class="fas fa-eye"></i><span>Preview Card</span></button>
        <button class="btn btn-secondary" id="resetBtn"><i class="fas fa-redo"></i><span>Reset Form</span></button>
      </div>
    </div>
  </div>
  
  <!-- Fixed Footer -->
  <footer class="main-footer">
    <div class="footer-content">
      &copy; 2025 Birthday Card Maker | Made with <i class="fas fa-heart" style="color: var(--primary);"></i> by <a href="#" target="_blank">SkillSphere</a>
    </div>
  </footer>
  
  <!-- Card Preview Modal -->
  <div class="card-preview-container" id="previewModal">
    <div class="card-preview">
      <button class="close-preview" id="closePreview">×</button>
      <div class="preview-bg"></div>
      <div class="floating-elements" id="floatingElements"></div>
      <div class="preview-content" id="cardPreview">
        <div class="preview-header">
          <h1 class="preview-title">Happy Birthday <span class="preview-name" id="previewName">Samuel</span>! 🎂</h1>
          <p class="preview-subtitle" id="previewSubtitle">The lord bless your new year, Age graciously 🙏</p>
        </div>
        
        <div class="preview-grid" id="previewGrid"></div>
        
        <div class="preview-message">
          <p class="preview-message-text" id="previewMessage">Your personalized birthday message will appear here in a beautiful layout.</p>
        </div>
        
        <p class="preview-footer">With love from <span class="preview-signature" id="previewSignature">Your Name</span></p>
      </div>
      
      <div class="btn-container" style="padding: 0 2rem 2rem;">
        <button class="btn" id="downloadBtn"><i class="fas fa-download"></i><span>Download Card</span></button>
        <button class="btn btn-secondary" id="shareBtn"><i class="fas fa-share-alt"></i><span>Share Online</span></button>
      </div>
    </div>
  </div>
  
  <script>
    // DOM Elements
    const celebrantName = document.getElementById('celebrantName');
    const birthdayTheme = document.getElementById('birthdayTheme');
    const birthdayMessage = document.getElementById('birthdayMessage');
    const signature = document.getElementById('signature');
    const photoUpload = document.getElementById('photoUpload');
    const uploadArea = document.getElementById('uploadArea');
    const musicUploadArea = document.getElementById('musicUploadArea');
    const photoCaptions = document.getElementById('photoCaptions');
    const musicFile = document.getElementById('musicFile');
    const audioPlayer = document.getElementById('audioPlayer');
    const generateBtn = document.getElementById('generateBtn');
    const resetBtn = document.getElementById('resetBtn');
    const previewModal = document.getElementById('previewModal');
    const closePreview = document.getElementById('closePreview');
    const downloadBtn = document.getElementById('downloadBtn');
    const shareBtn = document.getElementById('shareBtn');
    const imagePreview = document.getElementById('imagePreview');
    const previewGrid = document.getElementById('previewGrid');
    const previewName = document.getElementById('previewName');
    const previewSubtitle = document.getElementById('previewSubtitle');
    const previewMessage = document.getElementById('previewMessage');
    const previewSignature = document.getElementById('previewSignature');
    const floatingElements = document.getElementById('floatingElements');
    
    // State
    let uploadedImages = [];
    let audioFile = null;
    
    // Event Listeners
    uploadArea.addEventListener('click', () => photoUpload.click());
    musicUploadArea.addEventListener('click', () => musicFile.click());
    photoUpload.addEventListener('change', handleImageUpload);
    musicFile.addEventListener('change', handleMusicUpload);
    generateBtn.addEventListener('click', generateCard);
    resetBtn.addEventListener('click', resetForm);
    closePreview.addEventListener('click', closePreviewModal);
    downloadBtn.addEventListener('click', downloadCard);
    shareBtn.addEventListener('click', shareCard);
    
    // Functions
    function handleImageUpload(e) {
      const files = e.target.files;
      imagePreview.innerHTML = '';
      uploadedImages = [];
      
      // Create floating elements based on number of photos
      createFloatingElements(files.length > 0 ? files.length : 4);
      
      for (let i = 0; i < Math.min(files.length, 4); i++) {
        const file = files[i];
        const reader = new FileReader();
        
        reader.onload = function(event) {
          const imgContainer = document.createElement('div');
          imgContainer.className = 'preview-item';
          
          const img = document.createElement('img');
          img.src = event.target.result;
          
          const removeBtn = document.createElement('button');
          removeBtn.className = 'remove-btn';
          removeBtn.innerHTML = '×';
          removeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            removeImage(i);
          });
          
          imgContainer.appendChild(img);
          imgContainer.appendChild(removeBtn);
          imagePreview.appendChild(imgContainer);
          
          uploadedImages.push({
            src: event.target.result,
            file: file
          });
        };
        
        reader.readAsDataURL(file);
      }
      
      // Update upload area text if files were selected
      if (files.length > 0) {
        const uploadText = uploadArea.querySelector('.upload-text');
        uploadText.textContent = `${files.length} photo${files.length > 1 ? 's' : ''} selected`;
        
        if (files.length > 4) {
          const uploadSubtext = uploadArea.querySelector('.upload-subtext');
          uploadSubtext.textContent = `(Showing first 4 of ${files.length} images)`;
          uploadSubtext.style.color = 'var(--primary)';
        }
      }
    }
    
    function removeImage(index) {
      uploadedImages.splice(index, 1);
      const previewItems = document.querySelectorAll('.preview-item');
      previewItems[index].remove();
      
      // Update file input
      const dataTransfer = new DataTransfer();
      uploadedImages.forEach(img => {
        dataTransfer.items.add(img.file);
      });
      photoUpload.files = dataTransfer.files;
      
      // Update upload area text
      const uploadText = uploadArea.querySelector('.upload-text');
      const uploadSubtext = uploadArea.querySelector('.upload-subtext');
      uploadText.textContent = uploadedImages.length > 0 ? 
        `${uploadedImages.length} photo${uploadedImages.length > 1 ? 's' : ''} selected` : 
        'Click to upload photos';
      uploadSubtext.textContent = '(Up to 4 high-quality images)';
      uploadSubtext.style.color = '';
    }
    
    function handleMusicUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      audioFile = URL.createObjectURL(file);
      audioPlayer.src = audioFile;
      audioPlayer.style.display = 'block';
      
      // Update music upload area text
      const uploadText = musicUploadArea.querySelector('.upload-text');
      uploadText.textContent = file.name;
    }
    
    function createFloatingElements(count) {
      floatingElements.innerHTML = '';
      const elements = ['🎈', '🎉', '🎁', '✨', '🥂', '🎂', '💝', '🎊'];
      
      for (let i = 0; i < count * 2; i++) {
        const element = document.createElement('div');
        element.className = 'floating-element';
        element.textContent = elements[Math.floor(Math.random() * elements.length)];
        element.style.left = `${Math.random() * 100}%`;
        element.style.top = `${Math.random() * 100}%`;
        element.style.fontSize = `${Math.random() * 2 + 1.5}rem`;
        element.style.animationDuration = `${Math.random() * 10 + 10}s`;
        element.style.animationDelay = `${Math.random() * 5}s`;
        floatingElements.appendChild(element);
      }
    }
    
    function generateCard() {
      if (!celebrantName.value.trim()) {
        alert('Please enter the birthday person\'s name');
        celebrantName.focus();
        return;
      }
      
      // Update preview with user inputs
      previewName.textContent = celebrantName.value.trim();
      
      // Apply theme
      applyTheme(birthdayTheme.value);
      
      // Update message
      const message = birthdayMessage.value.trim() || 
        'Wishing you a day filled with joy, laughter, and all the happiness you bring to others!';
      previewMessage.innerHTML = formatMessage(message);
      
      // Update signature
      previewSignature.textContent = signature.value.trim() || 'Your Friend';
      
      // Update photo grid
      previewGrid.innerHTML = '';
      const captions = photoCaptions.value ? 
        photoCaptions.value.split(',').map(c => c.trim()) : 
        [];
      
      uploadedImages.forEach((img, index) => {
        const card = document.createElement('div');
        card.className = 'preview-card';
        
        const imgEl = document.createElement('img');
        imgEl.src = img.src;
        imgEl.loading = 'lazy';
        
        const caption = document.createElement('div');
        caption.className = 'preview-caption';
        caption.textContent = captions[index] || `Memory ${index + 1}`;
        
        card.appendChild(imgEl);
        card.appendChild(caption);
        previewGrid.appendChild(card);
      });
      
      // Show the preview modal
      previewModal.classList.add('show');
      document.body.style.overflow = 'hidden';
      
      // Trigger confetti if audio is playing
      if (!audioPlayer.paused) {
        triggerConfetti();
      }
    }
    
    function applyTheme(theme) {
      const cardPreview = document.querySelector('.card-preview');
      
      // Reset all themes
      cardPreview.classList.remove('theme-elegant', 'theme-modern', 'theme-fun', 'theme-romantic');
      
      // Apply selected theme
      switch(theme) {
        case 'elegant':
          cardPreview.classList.add('theme-elegant');
          previewSubtitle.textContent = 'Wishing you a day as wonderful as you are';
          break;
        case 'modern':
          cardPreview.classList.add('theme-modern');
          previewSubtitle.textContent = 'Celebrating you today and always';
          break;
        case 'fun':
          cardPreview.classList.add('theme-fun');
          previewSubtitle.textContent = 'Let\'s party! It\'s your special day!';
          break;
        case 'romantic':
          cardPreview.classList.add('theme-romantic');
          previewSubtitle.textContent = 'To the one who makes every day brighter';
          break;
        default:
          previewSubtitle.textContent = 'The lord bless your new year, Age graciously 🙏';
      }
    }
    
    function formatMessage(message) {
      // Simple formatting - you could enhance this with markdown or more complex formatting
      return message
        .split('\n')
        .map(paragraph => paragraph.trim() ? `<p>${paragraph}</p>` : '')
        .join('');
    }
    
    function triggerConfetti() {
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 },
        colors: ['#FF6B6B', '#4ECDC4', '#FFE66D', '#D4AF37']
      });
      
      setTimeout(triggerConfetti, 2000);
    }
    
    function closePreviewModal() {
      previewModal.classList.remove('show');
      document.body.style.overflow = '';
      audioPlayer.pause();
    }
    
    function downloadCard() {
      // Show loading state
      downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Generating Image...</span>';
      downloadBtn.disabled = true;
      
      // Hide buttons during capture
      const buttons = document.querySelectorAll('.card-preview .btn-container');
      buttons.forEach(btn => btn.style.display = 'none');
      
      // Capture the card
      html2canvas(document.getElementById('cardPreview'), {
        scale: 2,
        logging: false,
        useCORS: true,
        allowTaint: true,
        backgroundColor: null
      }).then(canvas => {
        // Create download link
        const link = document.createElement('a');
        link.download = `birthday-card-${celebrantName.value.trim() || 'friend'}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        // Restore buttons
        buttons.forEach(btn => btn.style.display = '');
        
        // Reset button state
        downloadBtn.innerHTML = '<i class="fas fa-download"></i><span>Download Card</span>';
        downloadBtn.disabled = false;
        
        // Show success effect
        triggerConfetti();
      });
    }
    
    function shareCard() {
      if (navigator.share) {
        navigator.share({
          title: `Birthday Card for ${celebrantName.value.trim()}`,
          text: `Check out this beautiful birthday card I made for ${celebrantName.value.trim()}!`,
          url: window.location.href
        }).catch(err => {
          console.log('Error sharing:', err);
          alert('Sharing failed. Please try another method.');
        });
      } else {
        alert('Web Share API not supported in your browser. You can download and share the image manually.');
      }
    }
    
    function resetForm() {
      celebrantName.value = '';
      birthdayMessage.value = '';
      signature.value = '';
      photoUpload.value = '';
      musicFile.value = '';
      audioPlayer.src = '';
      audioPlayer.style.display = 'none';
      imagePreview.innerHTML = '';
      uploadedImages = [];
      
      // Reset upload area text
      const uploadText = uploadArea.querySelector('.upload-text');
      const uploadSubtext = uploadArea.querySelector('.upload-subtext');
      uploadText.textContent = 'Click to upload photos';
      uploadSubtext.textContent = '(Up to 4 high-quality images)';
      uploadSubtext.style.color = '';
      
      // Reset music upload area text
      const musicUploadText = musicUploadArea.querySelector('.upload-text');
      musicUploadText.textContent = 'Add a birthday song';
    }
    
    // Initialize floating elements
    createFloatingElements(4);
  </script>
</body>
</html>
